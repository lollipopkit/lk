# Lang LK

## ç¬¬ä¸€è¡Œä»£ç 

```js
print("Hello World!")  // æˆ‘æ˜¯æ³¨é‡Š
```

ä»¥ä¸Šå†…å®¹åœ¨å±å¹•ä¸Šæ‰“å°å‡º `Hello World!`ã€‚  

## åŸºæœ¬ç±»å‹

```js
a = 1      // num
b = '1'    // str
a = false  // bool
a = {}     // table
c = nil    // nil
/* æˆ‘æ˜¯å¤šè¡Œæ³¨é‡Š */
```

`lk` ä¸­çš„åŸºæœ¬ç±»å‹æœ‰`num` `str` `bool` `nil` `table`ã€‚

```js
print(a == b) // å› ä¸º num != strï¼Œæ‰€ä»¥ false
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œè™½ç„¶ `lk` ä¸éœ€è¦æ˜ç¡®æŒ‡å‡ºå˜é‡çš„ç±»å‹ï¼Œä½†ä¸æ„å‘³ç€æ˜¯å¼±ç±»å‹è¯­è¨€ã€‚  
ä¸åŒç±»å‹é—´æ¯”è¾ƒï¼Œä¸ä¼šå…ˆè½¬åŒ–ä¸ºåŒç±»å‹ã€‚

```js
shy a = `
ğŸ˜Š`
print(a)  // ğŸ˜Š
```

`shy` å…³é”®å­— è¡¨ç¤º è¿™æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œä¸ `Lua` ä¸­çš„ `local` ä½œç”¨ä¸€è‡´ã€‚
`str` é™¤äº†å¯ä»¥ç”¨ `'` `"` åŒ…è£¹ï¼Œè¿˜å¯ä»¥ç”¨ `` ` `` åŒ…è£¹ï¼ˆ è¡¨ç¤ºè¿™æ˜¯ä¸ª `Raw String` ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…è¢«è½¬ä¹‰ã€‚
âš ï¸ å¦‚æœä½¿ç”¨ `Raw String` æ„é€ å­—ç¬¦ï¼Œä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæ¢è¡Œ ( `\n` )ï¼Œ**è¿™ç¬¬ä¸€ä¸ª**æ¢è¡Œä¼šè¢«å¿½ç•¥ï¼ˆå¦‚ä¸Šçš„å˜é‡ `a` å£°æ˜ï¼‰ã€‚

```js
shy tb = {
    'a': 1,
    'b': 2,
}

// `:=` è¡¨ç¤ºè¯¥å˜é‡ä¸ºç§æœ‰ï¼Œç­‰åŒäº `shy a = 'b'`
a := 'b'

print(tb[a])    // 2
print(tb.a)     // 1
print(tb['a'])  // 1
```

è¯·æ³¨æ„ï¼ŒTableAccess æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ `tb[a]`ï¼Œå¦ä¸€ç§æ˜¯ `tb.a`ã€‚

- `tb[a]` ä¼šå…ˆè®¡ç®— `a` çš„å€¼ï¼Œç„¶åå†å»è®¿é—® `tb` ä¸­çš„å€¼ã€‚
- `tb.a` ä¼šç›´æ¥å»è®¿é—® `tb` ä¸­ `key` ä¸º å­—ç¬¦`a` çš„å€¼ï¼Œä¸ä¼šè®¡ç®—å˜é‡ `a` çš„å€¼ã€‚

## å˜é‡

```js
a = 1
if true {
    a := 3
    print(a)  // 3
}
print(a)  // 1
```

`shy` & `:=` è¡¨ç¤ºè¯¥å˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼Œåªåœ¨å½“å‰ä½œç”¨åŸŸå†…æœ‰æ•ˆã€‚  
`a := 1` ç­‰åŒäº `shy a = 1`ã€‚  
è¯·**å°½é‡**å£°æ˜ä¸ºç§æœ‰å˜é‡ï¼Œè¿™ä¼šæé«˜ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼ˆå› ä¸ºä¸éœ€è¦å…¨å±€å¯»æ‰¾å˜é‡ï¼‰ã€‚  
`lk` ä¸­å·²ç»å£°æ˜çš„å˜é‡å¯ä»¥å†æ¬¡å£°æ˜ï¼Œè¿™æ—¶ä¼šåœ¨å…¶ä½œç”¨åŸŸå†…è¦†ç›–åŸæ¥çš„å€¼ã€‚  

```js
a, b = 1
print(a, b)  // 1 nil
```

`lk` ä¸­å¯ä»¥ä½¿ç”¨ `,` åˆ†éš”å¤šä¸ªå˜é‡ï¼Œè¿™æ—¶ä¼šå°†å¤šä¸ªå˜é‡çš„å€¼èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡ã€‚  
å¦‚æœå³è¾¹çš„å˜é‡ä¸ªæ•°å°‘äºå·¦è¾¹çš„å˜é‡ä¸ªæ•°ï¼Œé‚£ä¹ˆå¤šä½™çš„å˜é‡ä¼šè¢«èµ‹å€¼ä¸º `nil`ã€‚  

## å‡½æ•°

```js
shy fn add2(a, b) {
    rt a + b
}
add2 := fn(a, b) {
    rt a + b
}
print(add2(1, 2))  // 3
```

å’Œå˜é‡ä¸€è‡´ï¼Œ`shy` è¡¨ç¤ºå±€éƒ¨å‡½æ•°ã€‚  
ä»¥ä¸Šä¸¤ç§å£°æ˜ä½œç”¨ä¸€è‡´ï¼Œæ”¯æŒä»¥å˜é‡æ–¹å¼å£°æ˜å‡½æ•°ã€‚  

```js
fn addN(...) {
    sum = 0
    for _, i in {...} {
        sum += i
    }
    rt sum
}
addN(1, 2, 3, 4, 5)  // 15
```

`...` ä¸ºå˜é•¿å‚æ•°ï¼Œè¡¨æ˜0ä¸ªæˆ–æ›´å¤šä¸ªå‚æ•°ã€‚  
å¯ä»¥ä½¿ç”¨ `{...}` æ¥æ„é€ å‚æ•°åˆ—è¡¨ï¼Œå†ä½¿ç”¨ `for in` è·å–æ¯ä¸€ä¸ªå‚æ•°ã€‚  

```js
a := fn(b) => 3 ^ b, 2 ^ b
print(a(2))

shy a = fn(b) {rt 3 ^ b, 2 ^ b}
print(a(2))
```

ä¸¤ä¸ª `a` å‡½æ•°å£°æ˜çš„ä½œç”¨ä¸€è‡´ã€‚  
`=>` åè¿”å›å€¼åªèƒ½æœ‰ä¸€è¡Œã€‚

## å¾ªç¯

ä»¥ä¸‹å¾ªç¯éƒ½æ”¯æŒ `break` å…³é”®å­—ã€‚

```js
while condition {
    // ...
}
```

```js
for i = 0, 10 {
    // ...
}
```

ç­‰åŒäº `for i = 0; i <= 10; i++ {}`

```js
for i = 0, 10, 2 {
    // ...
}
```

ç­‰åŒäº `for i = 0; i <= 10; i += 2 {}`

## æµç¨‹æ§åˆ¶

```js
if condition {
    // ...
} elif condition {
    // ...
} else {
    // ...
}

// åœ¨ `if` åˆ¤æ–­æ—¶ï¼Œåªæœ‰ `nil` å’Œ `false` ä¼šè¢«åˆ¤æ–­ä¸º `false`
if '' and {} and 0 {
    if nil or false {
        print('never print')
    } else {
        print('only `nil` and `false` is false')
    }
}
```

## è¿ç®—

### ç®—æœ¯è¿ç®—ç¬¦

```js
a = 21
b = 10
c = a + b
print("Line 1 - c çš„å€¼ä¸º ", c)
c = a - b
print("Line 2 - c çš„å€¼ä¸º ", c)
c = a * b
print("Line 3 - c çš„å€¼ä¸º ", c)
c = a / b
print("Line 4 - c çš„å€¼ä¸º ", c)
c = a % b
print("Line 5 - c çš„å€¼ä¸º ", c)
c = a ^ 2
print("Line 6 - c çš„å€¼ä¸º ", c)
c = -a
print("Line 7 - c çš„å€¼ä¸º ", c)
```

è¾“å‡ºï¼š

```plaintext
Line 1 - c çš„å€¼ä¸º     31
Line 2 - c çš„å€¼ä¸º     11
Line 3 - c çš„å€¼ä¸º     210
Line 4 - c çš„å€¼ä¸º     2.1
Line 5 - c çš„å€¼ä¸º     1
Line 6 - c çš„å€¼ä¸º     441
Line 7 - c çš„å€¼ä¸º     -21
```

åŒæ—¶ï¼Œä¹Ÿæ”¯æŒ `a++` `a+=1` ç­‰

### å…³ç³»è¿ç®—ç¬¦

```js
a = 21
b = 10

if (a == b) {
   print("Line 1 - a ç­‰äº b")
else {
   print("Line 1 - a ä¸ç­‰äº b")
}

if (a != b) {
   print("Line 2 - a ä¸ç­‰äº b")
else {
   print("Line 2 - a ç­‰äº b")
}

if (a < b) {
   print("Line 3 - a å°äº b")
else {
   print("Line 3 - a å¤§äºç­‰äº b")
}

if (a > b) {
   print("Line 4 - a å¤§äº b")
else {
   print("Line 5 - a å°äºç­‰äº b")
}

// ä¿®æ”¹ a å’Œ b çš„å€¼
a = 5
b = 20
if (a <= b) {
   print("Line 5 - a å°äºç­‰äº b")
}

if (b >= a) {
   print("Line 6 - b å¤§äºç­‰äº a")
}
```

è¾“å‡ºï¼š

```plaintext
Line 1 - a ä¸ç­‰äº b
Line 2 - a ä¸ç­‰äº b
Line 3 - a å¤§äºç­‰äº b
Line 4 - a å¤§äº b
Line 5 - a å°äºç­‰äº b
Line 6 - b å¤§äºç­‰äº a
```

### é€»è¾‘è¿ç®—ç¬¦

```js
print(false and true)  // false
print(false or true)   // true
print(not false)       // true
// `not false` ç­‰äº `!false`
```

### å…¶ä»–è¿ç®—ç¬¦

```js
a = "Hello "
b = "World"

// è¿æ¥å­—ç¬¦ä¸² a å’Œ b
print(a + b)  // Hello World
// b å­—ç¬¦ä¸²é•¿åº¦
print(#b)   // 5

// `#`è·å–é•¿åº¦ï¼Œ`...`ä¸ºå˜é•¿å‚æ•°ï¼Œ`{}`æ„é€ Table
// `#{...}`å³è·å–å˜é•¿å‚æ•°çš„é•¿åº¦ï¼ˆæœ‰å¤šå°‘ä¸ªå‚æ•°ï¼‰
fn varagsLen(...) => print(#{...})

varagsLen(1, 2, 3, 4, 5)  // 5

// ä¸‰å…ƒæ“ä½œç¬¦
print(true ? 'support ternary exp' : 'unreachable')
```

### è¿ç®—ç¬¦ä¼˜å…ˆçº§

```js
a = 20
b = 10
c = 15
d = 5

e = (a + b) * c / d  // (30 * 15) / 5
print(e)  // 90.0

e = ((a + b) * c) / d  // (30 * 15) / 5
print(e)  // 90.0

e = (a + b) * (c / d)  // (30) * (15 / 5)
print(e)  // 90.0

e = a + (b * c) / d  // 20 + (150 / 5)
print(e)  // 50.0
```

## è¿­ä»£å™¨

### é»˜è®¤è¿­ä»£

```js
a := {'num': 1, 'str': '1', 'bool': false, 'nil': nil}
for k, v in a {
    print(k, v)
}
```

å…¶ä¸­ `for k, v in a` å°±åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨ï¼Œ
å½“ `a` æ˜¯ `table` æ—¶ï¼Œç¼–è¯‘å™¨ä¼šä½¿ç”¨å†…ç½®çš„è¿­ä»£å™¨ï¼Œåœ¨æ¯æ¬¡è¿­ä»£æ—¶ä¸º `k` å’Œ `v` åˆ†åˆ«èµ‹å€¼ä¸º `a` çš„é”®å’Œå€¼ã€‚

### è‡ªå®šä¹‰è¿­ä»£å™¨

#### æ— çŠ¶æ€è¿­ä»£å™¨

```js
fn square(iteratorMaxCount, currentNumber) {
    if currentNumber < iteratorMaxCount {
        currentNumber = currentNumber + 1
        rt currentNumber, currentNumber * currentNumber
    }
}

for i, n in square, 3, 0 {
   print(i, n)
}
```

è¿™æ ·å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„å¹³æ–¹è¿­ä»£å™¨ï¼Œè¾“å‡ºï¼š

```plaintext
1    1
2    4
3    9
```

#### æœ‰çŠ¶æ€è¿­ä»£å™¨

```js
fn iter(a, i) {
    i++
    v := a[i]
    if v {
       rt i, v
    }
}
 
fn ipairs(a) {
    // lk çš„ èµ·å§‹index ä¸º 0ï¼Œæ‰€ä»¥æ­¤å¤„ä¸º -1
    rt iter, a, -1
}
```

å¦‚ä¸Šï¼Œå®ç°äº†è™šæ‹Ÿæœºå†…ç½®çš„é»˜è®¤è¿­ä»£å™¨

## é¢å‘å¯¹è±¡ & å…ƒè¡¨

```js
// å®šä¹‰ä¸€ä¸ªç±»ï¼ŒåŒ…å«å…¶é»˜è®¤å±æ€§å€¼ï¼ˆx = 0, y = 0ï¼‰
class Vector { 'x': 0, 'y': 0 }

// åˆ›å»ºä¸€ä¸ª Vector å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œä¸ºå†…éƒ¨å±æ€§èµ‹å€¼
// å¦‚æœä½¿ç”¨`new(Vector)`ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ï¼ˆx = 0, y = 0ï¼‰
fn Vector.new(x, y) {
    shy v = new(Vector)
    v.x = x
    v.y = y
    rt v
}

// ä¸º `Vector` è®¾ç½® `__add` å…ƒæ–¹æ³•ï¼Œå®ç° `+` è¿ç®—ç¬¦
fn Vector.__add(v1, v2) {
    shy v = new(Vector)
    v.x = v1.x + v2.x
    v.y = v1.y + v2.y
    rt v
}

// `Object:function(...)` = `Object.function(self, ...)`
// è¿™é‡Œï¼š`Vector:set(x, y)` = `Vector.set(self, x, y)`
fn Vector:set(x, y) {
    self.x = x
    self.y = y
}

// ä¸º `Vector` è®¾ç½® `__str` å…ƒæ–¹æ³•ï¼Œ`print` `Vector` å¯¹è±¡æ—¶ä¼šè°ƒç”¨æ­¤æ–¹æ³•
// å¦‚æœä¸å®ç°æ­¤æ–¹æ³•ï¼Œä¼šä½¿ç”¨å†…ç½®çš„è½¬æ¢ä¸º `to_str` çš„æ–¹æ³•
fn Vector:__str() {
    rt 'Vector(' + to_str(self.x) + ', ' + to_str(self.y) + ')'
}

// ä½¿ç”¨çš„`new(Object)`ï¼Œæ‰€ä»¥ä½¿ç”¨çš„é»˜è®¤å±æ€§å€¼
// æ­¤æ—¶ x = 0, y = 0
shy v1 = new(Vector)
// å¸¦å€¼çš„åˆå§‹åŒ–å¯¹è±¡
// æ­¤æ—¶ x = 3, y = 4
shy v2 = Vector.new(3, 4)
// è°ƒç”¨ `Vector:set(x, y)` æ–¹æ³•ï¼Œä¿®æ”¹v1çš„å€¼
v1:set(1, 2)
shy v3 = v1 + v2
print(v3.x, v3.y)  // 4       6

// ä¸Šé¢å®ç°äº† `Vector:__str()` æ–¹æ³•ï¼Œæ­¤å¤„ä¼šè°ƒç”¨
printf('%s + %s = %s', v1, v2, v3)  // Vector(1, 2) + Vector(3, 4) = Vector(4, 6)
```

ä»¥ä¸‹æ˜¯éƒ¨åˆ†å¯ä»¥æ‹“å±•çš„å…ƒæ–¹æ³•è¡¨ï¼š  

|æ“ä½œç¬¦/ä½œç”¨|metatable|
|-|-|
|`+`|`__add`|
|`-`|`__sub`|
|`*`|`__mul`|
|`/`|`__div`|
|`%`|`__mod`|
|`^`|`__pow`|
|`-`|`__unm`|
|`~/`|`__idiv`|
|`#`|`__len`|
|`==`|`__eq`|
|`<`|`__lt`|
|`<=`|`__le`|
|ç´¢å¼•|`__index`|
|æ–°ç´¢å¼•|`__newindex`|
|è½¬ä¸º`str`|`__str`|
|è°ƒç”¨æ–¹æ³•|`__call`|
|è·å–åç§°|`__name`|
|è¿­ä»£å™¨|`__iter`|

## åŒ…

```js
// æ–‡ä»¶åä¸º mod.lk
class module {}
 
// å®šä¹‰ä¸€ä¸ªå¸¸é‡
module.constant = "è¿™æ˜¯ä¸€ä¸ªå¸¸é‡"
 
// å®šä¹‰ä¸€ä¸ªå‡½æ•°
fn module.func1() {
    print("è¿™æ˜¯ä¸€ä¸ªå…¬æœ‰å‡½æ•°ï¼\n")
}
 
shy fn func2() {
    print("è¿™æ˜¯ä¸€ä¸ªç§æœ‰å‡½æ•°ï¼")
}
 
fn module.func3() {
    func2()
}

rt module
```

å¦‚ä¸Šå®šä¹‰äº†ä¸€ä¸ªåŒ…ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥ï¼š

```js
import "mod"
```

å¯ä»¥é€šè¿‡ `import` å…³é”®å­—å¯¼å…¥åŒ…ï¼Œå¯¼å…¥çš„åŒ…ä¼šåœ¨å½“å‰æ–‡ä»¶ä½œç”¨åŸŸä¸­æœ‰æ•ˆã€‚  
å¯¼å…¥è·¯å¾„ `mod` ä¸ºå½“å‰æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ã€‚  
ä¾‹å¦‚`import "a/b/c"`ï¼Œä¼šå°è¯•å¯¼å…¥ï¼š`./a/b/c.lk` `./a/b/c/init.lk`ã€‚  

å¯¼å…¥åå¦‚ä¸‹ä½¿ç”¨ï¼š

```js
module.func1()
// module.func2() ä¸å¯ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºæ˜¯å±€éƒ¨å‡½æ•°ï¼Œä½†å¯ä»¥é€šè¿‡ module.func3() è°ƒç”¨
module.func3()
```

```js
// è®¾ç½®åˆ«åï¼Œæ–¹ä¾¿è°ƒç”¨
m := import('mod')
m.func1()
```

éœ€è¦æ³¨æ„ï¼Œ`class module` åœ¨æœ€å `rt module`ï¼Œå¦‚æœä¸ `rt`ï¼Œåˆ™å¯¼å…¥æ—¶æ— æ³•è®¾ç½®åˆ«åã€‚

## åç¨‹

```js
fn foo(a) {
    print("foo å‡½æ•°è¾“å‡º", a)
    rt coroutine.yield(2 * a) // è¿”å› 2*a çš„å€¼
}
 
co = sync.create(fn (a , b) {
    print("ç¬¬ä¸€æ¬¡ååŒç¨‹åºæ‰§è¡Œè¾“å‡º", a, b) // co-body 1 10
    shy r = foo(a + 1)
     
    print("ç¬¬äºŒæ¬¡ååŒç¨‹åºæ‰§è¡Œè¾“å‡º", r)
    shy r, s = coroutine.yield(a + b, a - b)  // aï¼Œbçš„å€¼ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨ååŒç¨‹åºæ—¶ä¼ å…¥
     
    print("ç¬¬ä¸‰æ¬¡ååŒç¨‹åºæ‰§è¡Œè¾“å‡º", r, s)
    rt b, "ç»“æŸååŒç¨‹åº"  // bçš„å€¼ä¸ºç¬¬äºŒæ¬¡è°ƒç”¨ååŒç¨‹åºæ—¶ä¼ å…¥
})
       
print("main", coroutine.resume(co, 1, 10)) // true, 4
print()
print("main", coroutine.resume(co, "r")) // true 11 -9
print()
print("main", coroutine.resume(co, "x", "y")) // true 10 end
print()
print("main", coroutine.resume(co, "x", "y")) // cannot resume dead sync
print()
```

## æ ‡å‡†åº“

è¯·æŸ¥çœ‹æºç  [stdlib](stdlib)
